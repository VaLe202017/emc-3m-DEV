~inc:header.inc~
<div id="content">
<h1>Upravljanje uređajem</h1>
<div id="upr">

    <div id="config">
        <div class="uprData" style="text-align: center;">izvori točnog vremena</div>
        <form>
            <div><input type="checkbox" id="GPSakt" name="GPSakt"><label for="GPSakt">Aktiviraj GPS</label></div>
            <div><input type="checkbox" id="NTPakt" name="NTPakt"><label for="NTPakt">Aktiviraj NTP</label></div>
            <div class="uprData" style="text-align: center;">Relejni izlazi:</div>

            <div><input type="checkbox" id="R1akt" name="R1akt"> <label for="R1akt">Aktiviraj izlaz R1</label></div>
            <div><input type="checkbox" id="R2akt" name="R2akt"> <label for="R2akt">Aktiviraj izlaz R2</label></div>
            <div><input type="checkbox" id="ZLakt" name="ZLakt"> <label for="ZLakt">Aktiviraj  zimsko ljetno vrijeme</label></div>

            <div id="timeZone">
                <label for="zoneSelect" id="zoneLabel">Vremenska zona:</label>
                <select id="zoneSelect">
                    <option value="0">UTC-12:00</option>
                    <option value="1">UTC-11:00</option>
                    <option value="2">UTC-10:00</option>
                    <option value="3">UTC-09:00</option>
                    <option value="4">UTC-08:00</option>
                    <option value="5">UTC-07:00</option>
                    <option value="6">UTC-06:00</option>
                    <option value="7">UTC-05:00</option>
                    <option value="8">UTC-04:00</option>
                    <option value="9">UTC-03:00</option>
                    <option value="10">UTC-02:00</option>
                    <option value="11">UTC-01:00</option>
                    <option value="12" selected>UTC</option>
                    <option value="13">UTC+01:00</option>
                    <option value="14">UTC+02:00</option>
                    <option value="15">UTC+03:00</option>
                    <option value="16">UTC+04:00</option>
                    <option value="17">UTC+05:00</option>
                    <option value="18">UTC+06:00</option>
                    <option value="19">UTC+07:00</option>
                    <option value="20">UTC+08:00</option>
                    <option value="21">UTC+09:00</option>
                    <option value="22">UTC+10:00</option>
                    <option value="23">UTC+11:00</option>
                    <option value="24">UTC+12:00</option>
                    <option value="25">UTC+13:00</option>
                    <option value="26">UTC+14:00</option>
            </select>
            </div>

            <div><input type="button"   id="SubmitBut" value="Pošalji konfiguraciju" class="relayButton" style="font-size: 15px; margin-top: 10px; margin-left: 80px; margin-bottom: 10px;"></div>
        </form>
        
    </div>

    <div id="data">
        <div id="uprDataGPS" class="uprData">Zadnja GPS sink. [UTC]:</div>     <div id="GPS" class="uprData">00.00.0000 00:00:00</div><div><button id= "rstg" style="margin-left: 10px;" class="relayButton">GPS Reset</button></div>
        <div id="uprDataNTP" class="uprData">Zadnja NTP sink. [UTC]:</div>     <div id="NTP" class="uprData">00.00.0000 00:00:00</div><div></div>
        <div id="uprDataT" class="uprData">Ručni unos vremena [UTC]:</div>           <div id="time" class="uprData">00.00.0000 00:00:00</div><div></div>
        <div id="uprDataR" class="uprData">R1 - R4 zahtijevano vrijeme:</div>           <div id="R" class="uprData">00.00.0000 00:00:00</div><div></div>
        <div id="uprDataVb" class="uprData">Napon baterije:</div>                       <div id="Vb" class="uprData">0 Volts</div><div></div>
        <div id="uprDataVs" class="uprData">Napon izvora:</div>                         <div id="Vs" class="uprData">0 Volts</div><div></div>
        <div id="uprDataVt" class="uprData">Rad na baterijama:</div>                    <div id="Vt" class="uprData">0 min</div><div></div>
        <div><button id= "rstr" class="relayButton" style="margin-left: 50px;">Poništi vrijeme rada na baterijama</button></div><div></div><div></div>
    </div>
 
    <div id="toggleRelay">
        <div id="ind1" class="indication" id="r1"></div>
        <div id="ind2" class="indication" id="r2"></div>
        
        <button id="R1" class="relayButton">R1</button>
        <button id="R2" class="relayButton">R2</button>
    </div>
</div>
</div>

~inc:footer.inc~

<script language="javascript">
    
    var relay1= document.getElementById("R1");
    var relay2= document.getElementById("R2");
    var rstg= document.getElementById("rstg");
    
    relay1.onclick= function(){
        setTimeout("newAJAXCommand('/admin/rly.cgi?relay=1',false)", 500);
    }
    relay2.onclick= function(){
         setTimeout("newAJAXCommand('/admin/rly.cgi?relay=2',false)", 500);
    }

    rstg.onclick= function(){
        setTimeout("newAJAXCommand('/admin/flt.cgi?flt=g',false)", 500);
    }
    rstr.onclick= function(){
        setTimeout("newAJAXCommand('/admin/flt.cgi?flt=r',false)", 500);
    }


    function update(xmlData){ 
        var str= getXMLValue(xmlData, 'rl14');

        var sinkronizacijaGPS= getXMLValue(xmlData, 'gps');
        sinkronizacijaGPS= sinkronizacijaGPS.split('  ');
        sinkronizacijaGPSDatum= sinkronizacijaGPS[0].split('.');
        sinkronizacijaGPSVrijeme= sinkronizacijaGPS[1].split(':');
        sinkronizacijaGPSDatum.pop();

        if(sinkronizacijaGPSDatum[0].length==1){
            sinkronizacijaGPSStr= '0' + sinkronizacijaGPSDatum[0] + '.';
        }else{
            sinkronizacijaGPSStr= sinkronizacijaGPSDatum[0] + '.';
        }

        if(sinkronizacijaGPSDatum[1].length==1){
            sinkronizacijaGPSStr+= '0' + sinkronizacijaGPSDatum[1] + '.';
        }else{
            sinkronizacijaGPSStr+= sinkronizacijaGPSDatum[1] + '.';
        }

        sinkronizacijaGPSStr+= sinkronizacijaGPSDatum[2] + '.  ';

        if(sinkronizacijaGPSVrijeme[0].length==1){
            sinkronizacijaGPSStr+= '0' + sinkronizacijaGPSVrijeme[0] + ':';
        }else{
            sinkronizacijaGPSStr+= sinkronizacijaGPSVrijeme[0] + ':';
        }

        if(sinkronizacijaGPSVrijeme[1].length==1){
            sinkronizacijaGPSStr+= '0' + sinkronizacijaGPSVrijeme[1] + ':';
        }else{
            sinkronizacijaGPSStr+= sinkronizacijaGPSVrijeme[1] + ':';
        }

        if(sinkronizacijaGPSVrijeme[2].length==1){
            sinkronizacijaGPSStr+= '0' + sinkronizacijaGPSVrijeme[2];
        }else{
            sinkronizacijaGPSStr+= sinkronizacijaGPSVrijeme[2];
        }

        if(sinkronizacijaGPSStr=='00.00.2000.  00:00:00'){
            sinkronizacijaGPSStr='-- -- ----  -- -- --';
        }

        document.getElementById("GPS").innerHTML= sinkronizacijaGPSStr;
        
        var sinkronizacijaNTP= getXMLValue(xmlData, 'ntp');
        sinkronizacijaNTP= sinkronizacijaNTP.split('  ');
        sinkronizacijaNTPDatum= sinkronizacijaNTP[0].split('.');
        sinkronizacijaNTPVrijeme= sinkronizacijaNTP[1].split(':');
        sinkronizacijaNTPDatum.pop();

        if(sinkronizacijaNTPDatum[0].length==1){
            sinkronizacijaNTPStr= '0' + sinkronizacijaNTPDatum[0] + '.';
        }else{
            sinkronizacijaNTPStr= sinkronizacijaNTPDatum[0] + '.';
        }

        if(sinkronizacijaNTPDatum[1].length==1){
            sinkronizacijaNTPStr+= '0' + sinkronizacijaNTPDatum[1] + '.';
        }else{
            sinkronizacijaNTPStr+= sinkronizacijaNTPDatum[1] + '.';
        }

        sinkronizacijaNTPStr+= sinkronizacijaNTPDatum[2] + '.  ';

        if(sinkronizacijaNTPVrijeme[0].length==1){
            sinkronizacijaNTPStr+= '0' + sinkronizacijaNTPVrijeme[0] + ':';
        }else{
            sinkronizacijaNTPStr+= sinkronizacijaNTPVrijeme[0] + ':';
        }

        if(sinkronizacijaNTPVrijeme[1].length==1){
            sinkronizacijaNTPStr+= '0' + sinkronizacijaNTPVrijeme[1] + ':';
        }else{
            sinkronizacijaNTPStr+= sinkronizacijaNTPVrijeme[1] + ':';
        }

        if(sinkronizacijaNTPVrijeme[2].length==1){
            sinkronizacijaNTPStr+= '0' + sinkronizacijaNTPVrijeme[2];
        }else{
            sinkronizacijaNTPStr+= sinkronizacijaNTPVrijeme[2];
        }

        if(sinkronizacijaNTPStr=='00.00.2000.  00:00:00'){
            sinkronizacijaNTPStr='-- -- ----  -- -- --';
        }

        document.getElementById("NTP").innerHTML= sinkronizacijaNTPStr;

        var sinkronizacijaMAN= getXMLValue(xmlData, 'man');
        sinkronizacijaMAN= sinkronizacijaMAN.split('  ');
        sinkronizacijaMANDatum= sinkronizacijaMAN[0].split('.');
        sinkronizacijaMANVrijeme= sinkronizacijaMAN[1].split(':');
        sinkronizacijaMANDatum.pop();

        if(sinkronizacijaMANDatum[0].length==1){
            sinkronizacijaMANStr= '0' + sinkronizacijaMANDatum[0] + '.';
        }else{
            sinkronizacijaMANStr= sinkronizacijaMANDatum[0] + '.';
        }

        if(sinkronizacijaMANDatum[1].length==1){
            sinkronizacijaMANStr+= '0' + sinkronizacijaMANDatum[1] + '.';
        }else{
            sinkronizacijaMANStr+= sinkronizacijaMANDatum[1] + '.';
        }

        sinkronizacijaMANStr+= sinkronizacijaMANDatum[2] + '.  ';

        if(sinkronizacijaMANVrijeme[0].length==1){
            sinkronizacijaMANStr+= '0' + sinkronizacijaMANVrijeme[0] + ':';
        }else{
            sinkronizacijaMANStr+= sinkronizacijaMANVrijeme[0] + ':';
        }

        if(sinkronizacijaMANVrijeme[1].length==1){
            sinkronizacijaMANStr+= '0' + sinkronizacijaMANVrijeme[1] + ':';
        }else{
            sinkronizacijaMANStr+= sinkronizacijaMANVrijeme[1] + ':';
        }

        if(sinkronizacijaMANVrijeme[2].length==1){
            sinkronizacijaMANStr+= '0' + sinkronizacijaMANVrijeme[2];
        }else{
            sinkronizacijaMANStr+= sinkronizacijaMANVrijeme[2];
        }
        if(sinkronizacijaMANStr=='00.00.2000.  00:00:00'){
            sinkronizacijaMANStr='-- -- ----  -- -- --';
        }
    
        document.getElementById("time").innerHTML= sinkronizacijaMANStr;

        var sinkronizacijaRTIM= getXMLValue(xmlData, 'rtim');
        sinkronizacijaRTIM= sinkronizacijaRTIM.split('  ');
        sinkronizacijaRTIMDatum= sinkronizacijaRTIM[0].split('.');
        sinkronizacijaRTIMVrijeme= sinkronizacijaRTIM[1].split(':');
        sinkronizacijaRTIMDatum.pop();

        if(sinkronizacijaRTIMDatum[0].length==1){
            sinkronizacijaRTIMStr= '0' + sinkronizacijaRTIMDatum[0] + '.';
        }else{
            sinkronizacijaRTIMStr= sinkronizacijaRTIMDatum[0] + '.';
        }

        if(sinkronizacijaRTIMDatum[1].length==1){
            sinkronizacijaRTIMStr+= '0' + sinkronizacijaRTIMDatum[1] + '.';
        }else{
            sinkronizacijaRTIMStr+= sinkronizacijaRTIMDatum[1] + '.';
        }

        sinkronizacijaRTIMStr+= sinkronizacijaRTIMDatum[2] + '.  ';

        if(sinkronizacijaRTIMVrijeme[0].length==1){
            sinkronizacijaRTIMStr+= '0' + sinkronizacijaRTIMVrijeme[0] + ':';
        }else{
            sinkronizacijaRTIMStr+= sinkronizacijaRTIMVrijeme[0] + ':';
        }

        if(sinkronizacijaRTIMVrijeme[1].length==1){
            sinkronizacijaRTIMStr+= '0' + sinkronizacijaRTIMVrijeme[1] + ':';
        }else{
            sinkronizacijaRTIMStr+= sinkronizacijaRTIMVrijeme[1] + ':';
        }

        if(sinkronizacijaMANVrijeme[2].length==1){
            sinkronizacijaRTIMStr+= '0' + sinkronizacijaMANVrijeme[2];
        }else{
            sinkronizacijaRTIMStr+= sinkronizacijaMANVrijeme[2];
        }
        if(sinkronizacijaRTIMStr=='00.00.200.  00:00:00'){
            sinkronizacijaRTIMStr='-- -- ----  -- -- --';
        }

        document.getElementById("R").innerHTML= sinkronizacijaRTIMStr;
        
        document.getElementById("Vb").innerHTML= getXMLValue(xmlData, 'nbat');
        document.getElementById("Vs").innerHTML= getXMLValue(xmlData, 'nnap');
        document.getElementById("Vt").innerHTML= getXMLValue(xmlData, 'bnap');
      
        var statusR1= str[0];
        var statusR2= str[2];

        var ind1= document.getElementById("ind1");
        var ind2= document.getElementById("ind2");
        var ind3= document.getElementById("ind3");
        var ind4= document.getElementById("ind4");
        
        if(statusR1== '1'){
            ind1.style.backgroundColor= 'green';
        }else{
            ind1.style.backgroundColor= '';
        }

        if(statusR2== '1'){
            ind2.style.backgroundColor= 'green';
        }else{
            ind2.style.backgroundColor= '';
        }

        if(document.getElementById('GPSakt').checked== true){
            var povezanostGPS= getXMLValue(xmlData, 'checkGPS');
            console.log(povezanostGPS);
            if(povezanostGPS== 86){
                document.getElementById('GPS').style.backgroundColor= 'red';
            }else if(povezanostGPS== 65){
				document.getElementById('GPS').removeAttribute('style');
            }else if(povezanostGPS== 32){
                document.getElementById('GPS').removeAttribute('style');
				document.getElementById('GPS').style.color= 'red';
        }else{
            document.getElementById('GPS').removeAttribute('style');
        }
        
    }
    }

    setTimeout("newAJAXCommand('upr.xml', update, true)",500);

    var submitbut= document.getElementById("SubmitBut");
    

    
    submitbut.onclick= function(){
        let arrCheck= '';

        if(document.querySelector("#GPSakt").checked){
            arrCheck+= '1';
        }else{
            arrCheck+= '0';
        }
        arrCheck+= ',';
        if(document.querySelector("#NTPakt").checked){
            arrCheck+= '1';
        }else{
            arrCheck+= '0';
        }
        arrCheck+= ',';
        if(document.querySelector("#R1akt").checked){
            arrCheck+= '1';
        }else{
            arrCheck+= '0';
        }
        arrCheck+= ',';
        if(document.querySelector("#R2akt").checked){
            arrCheck+= '1';
        }else{
            arrCheck+= '0';
        }
        arrCheck+= ',';
        if(document.querySelector("#ZLakt").checked){
            arrCheck+= '1';
        }else{
            arrCheck+= '0';
        }
        arrCheck+= ',';
        

        var selectElement= document.getElementById("zoneSelect");
        var selectedOption= selectElement.options[selectElement.selectedIndex].value;
    
        arrCheck= arrCheck + selectedOption;
        const endpoint= `/admin/upr.cgi?upr=${arrCheck}`;
        
        fetch(endpoint,{
            method: 'POST'
        })
        .then(response=>{response.json();})
        .then(data => {console.log('Data received:', data);})
        .catch(error => {console.error('Error during fetch:', error);})
    }

    window.onload = function(){
        activeTab();
        newAJAXCommand('uconf.xml', pullSavedData, false); 
    }
    function pullSavedData(xmlData) {
        var dataSaved= getXMLValue(xmlData, 'uconf');

        if(dataSaved[0]=='1'){
            document.getElementById('GPSakt').checked= true;
        }
        if(dataSaved[2]=='1'){
            document.getElementById('NTPakt').checked= true;
        }
        if(dataSaved[4]=='1'){
            document.getElementById('R1akt').checked= true;
        }
        if(dataSaved[6]=='1'){
            document.getElementById('R2akt').checked= true;
        }
        if(dataSaved[12]=='1'){
            document.getElementById('ZLakt').checked= true;
        }
        if(dataSaved[15]==null){
            document.getElementById('zoneSelect').value= dataSaved[14];
        }else{
            document.getElementById('zoneSelect').value= dataSaved[14] + dataSaved[15];
        }
    };


        
    /*----------------------*/
    /*function updateSubmit(xmlData){
        var podaci= getXMLValue(xmlData, 'uconf');
        //console.log(podaci);
    }
    //setTimeout("newAJAXCommand('uconf.xml', updateSubmit, true)",5000);*/
    /*----------------------*/

</script>

<style>

    #timeZone {
        margin-top: 5px;
    }

    #zoneLabel{
        border:2px solid #8b0000;
        border-radius: 10px;
        padding: 5px;
    }

    #config {
        display: grid;
        grid-template-columns: auto;
        grid-template-rows: repeat(11,auto);
        border: 2px solid;
        border-radius: 10px;
        padding: 5px;
    }

    #upr {
        display: grid;
        grid-template-columns: auto auto;
        grid-template-rows: auto;
    }


    #data {
        padding: 1px;
        display: grid;
        grid-template-columns: 250px 200px 150px;
        grid-template-rows: 30px 30px 30px 30px 30px 30px 30px 50px;
        gap: 2px;
        align-items: center;
    }


    #toggleRelay {
        display: grid; 
        grid-template-columns: repeat(4, 45px); 
        grid-template-rows: repeat(2, 45px); 
         
        padding: 5px; 
        width: 160px; 
        height: 80px;
    }

    #GPS, #NTP, #time, #R, #Vb, #Vs, #Vt{
        text-align: center;
    }
    #rstg, #rstr {
        width: 155px;
        font-size: 12px;
    }

    .uprData {
        border:2px solid #8b0000;
        border-radius: 10px;
        margin: 2px;
        text-align: right;
        padding: 5px;
    }

    .relayButton {
	margin: 2px;
	padding: 5px 10px;
	font-size: 10px; 
	background-color: #8b0000; 
	color: white; 
	border-radius: 10px;
    box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);
    }
    .relayButton:hover {
        background-color: gray;
    }
    .indication {
        margin: 2px;
        padding: 10px 15px;
        background-color: white;
        border: 2px solid;
        border-radius: 5px;
    }
</style>