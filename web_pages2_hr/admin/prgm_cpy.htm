~inc:header.inc~
<div id="content">
<h1>Podešavanje izlaza</h1>
	<div id="main">
		<div id="gornjiRed"><button class="butt" id="ucitajEMC">Učitaj sa EMC-a</button><button class="butt" id="SpremiEMC">Spremi u EMC</button><button class="butt" id="otkaz">Otkaži</button><span class="memorija" id="memorijaPop">Memorija: 000/800</span><span class="memorija" id="ucitavanje" style="margin-right: 75px;">Učitavanje: 000 od 000</span><button class="butt" id="brisiSve" style="float: right;">Briši sve unose</button></div>
			<div id="box">
				<div class="columnStyle" id="tjedniProgram">
					<div class="tjedniProgramGore1"><div class="memorija">Tjedni program:</div><div><select id="tjedniProgramSelect" style="width: 50px;"></select></div><div><button class="butt" id="buttUp" style="width: 50px;">+</button></div><div><button class="butt" id="buttDown" style="width: 50px;">-</button></div></div>
					<div class="tjedniProgramGore2"><div class="memorija">Vrijeme:</div><div class="memorija">Trajanje uklopa</div></div>
					<div class="tjedniProgramGore2"><div class="memorija"><input type="time" id="vrijemeUklopa" value="00:00" style="width: 150px; text-align: center;"></div><div class="memorija"><input type="text" id="trajanjeUklopa" value="Off" style="text-align: center; width: 50px;"></div></div>
					<div id="slideri"><div><input type="range" id="vrijemeSati" min="0" max="23" step="1" value="0" style="width: 70px;"></div><div><input type="range" id="vrijemeMinute" min="0" max="59" step="1" value="0" style="width: 70px;"></div><div></div><div><input type="range" id="sliderUklop" value="0" min="0" max="100" step="1" style="width: 70px;"></div></div>
					<div style="text-align: center; margin: 0px 40px; border-bottom: 2px solid;"><input type="checkbox" id="sviDani"><label for="sviDani">Svi dani</label></div>
					<div id="dani"><div><input type="checkbox" id="pon"><label for="pon">Pon</label></div><div><input type="checkbox" id="uto"><label for="uto">Uto</label></div><div><input type="checkbox" id="sri"><label for="sri">Sri</label></div><div><input type="checkbox" id="cet"><label for="cet">Čet</label></div><div><input type="checkbox" id="pet"><label for="pet">Pet</label></div><div><input type="checkbox" id="sub"><label for="sub">Sub</label></div><div><input type="checkbox" id="ned"><label for="Ned">Ned</label></div></div>
					<div style="text-align: center;"><button class="butt" id="dodajVremListu">Dodaj u vremensku listu</button></div>
					<div class="memorija" style="margin-right: 230px;">Vremenska lista:</div>
					<div class="memorija"><span style="margin-left: 5px; margin-right: 35px;">Vrijeme</span><span style="margin-right: 60px;">Dan u tjednu</span><span>Trajanje</span></div>
					<div id="vremenskaLista" style="border: 1px solid; height: 325px; width: 370px; overflow-y: scroll; border: 2px solid #8b0000"></div>
				</div>
				<div class="columnStyle" id="godisnjaLista">
					<div id="odabirIzlazaDatuma">
						<div id="odabirReleja">
							<div class="memorija">Izlaz:</div>
							<div><select id="releji">
								<option value="0">R1-R4</option>
								<option value="241">R1</option>
								<option value="242">R2</option>
								<option value="243">R3</option>
								<option value="244">R4</option>
							</select></div>
						</div>
						<div id="odabirDatuma">
							<div class="memorija">odabir Datuma:</div>
							<div id="dropDownDatum"><input type="date" id="dateChoosen" min="2020-01-01" value="2020-01-01"></div>
						</div>
						<div id="odabirPrograma">
							<div class="memorija">Tjedni program:</div>
							<div><select id="programGodisnja" style="width: 50px;"></select></div>
						</div>
					</div>
					<div style="text-align: center;"><button class="butt" id="dodajGodListu" style="width: 200px;">Dodaj godišnju listu</button></div>
					<div class="memorija" style="margin-right: 250px;">Godišnja lista:</div>
					<div class="memorija"><span style="margin-left: 5px; margin-right: 30px;">Izlaz</span><span style="margin-right: 30px;">Pokreni od datuma</span><span>Program</span></div>
					<div id="godiListaPrikaz" style="border: 1px solid; height: 450px; width: 375px; overflow-y: scroll;border: 2px solid #8b0000;"></div>
				</div>
				<div class="columnStyle" id="teksProgram">
					<div class="memorija">Tekstualni program:</div>
					<div style="padding: 5px;"><textarea id="tekstProgram" style="resize: none; height: 500px; background-color: #202020; color: white; border: 2px solid #8b0000"></textarea></div>
					<div style="text-align: center"><button class="butt" id="ucitajIzTeksta">Učitaj iz teksta</button></div>
				</div>
			</div>
		<div id="link">www.elak.com</div>
	</div>
</div>
~inc:footer.inc~

<script language="javascript">
	var yearList= []; // Glavne varijable za spremanje vremena zvonjenja
	var weekList= []; // Glavne varijable za spremanje vremena zvonjenja
	var otkaziSlanje= false;

	var sviDaniCheck= document.getElementById('sviDani');
	sviDaniCheck.addEventListener('click', function(){
		if(sviDaniCheck.checked){
			document.getElementById('pon').checked= true;
			document.getElementById('uto').checked= true;
			document.getElementById('sri').checked= true;
			document.getElementById('cet').checked= true;
			document.getElementById('pet').checked= true;
			document.getElementById('sub').checked= true;
			document.getElementById('ned').checked= true;

			document.getElementById('pon').disabled= true;
			document.getElementById('uto').disabled= true;
			document.getElementById('sri').disabled= true;
			document.getElementById('cet').disabled= true;
			document.getElementById('pet').disabled= true;
			document.getElementById('sub').disabled= true;
			document.getElementById('ned').disabled= true;
		}else{
			document.getElementById('pon').checked= false;
			document.getElementById('uto').checked= false;
			document.getElementById('sri').checked= false;
			document.getElementById('cet').checked= false;
			document.getElementById('pet').checked= false;
			document.getElementById('sub').checked= false;
			document.getElementById('ned').checked= false;

			document.getElementById('pon').disabled= false;
			document.getElementById('uto').disabled= false;
			document.getElementById('sri').disabled= false;
			document.getElementById('cet').disabled= false;
			document.getElementById('pet').disabled= false;
			document.getElementById('sub').disabled= false;
			document.getElementById('ned').disabled= false;
		}
	})

	document.getElementById('vrijemeSati').addEventListener('input', function(){
		var vrijeme= document.getElementById('vrijemeUklopa').value
		var [sati, minute]= vrijeme.split(':');
		if(this.value.length==1){
			sati= '0' + this.value;
		}else{
			sati= this.value;
		}
		document.getElementById('vrijemeUklopa').value= sati + ':' + minute;
	})

	document.getElementById('vrijemeMinute').addEventListener('input', function(){
		var vrijeme= document.getElementById('vrijemeUklopa').value
		var [sati, minute]= vrijeme.split(':');
		if(this.value.length==1){
			minute= '0' + this.value;
		}else{
			minute= this.value;
		}
		document.getElementById('vrijemeUklopa').value= sati + ':' + minute;
	})

	document.getElementById('sliderUklop').addEventListener('input', function(){
		if(this.value==0){
			document.getElementById('trajanjeUklopa').value= 'Off'
		}else if(this.value==100){
			document.getElementById('trajanjeUklopa').value= 'On'
		}else{
			document.getElementById('trajanjeUklopa').value= this.value
		}
		
	})

	function dodajVremenskuListu(dataGroup, vrijemePodatak, dani, trajanjeImpulsa){
		var novaVremenskaLista= document.createElement('div');
		novaVremenskaLista.className= 'memorija';
		novaVremenskaLista.setAttribute('data-group', dataGroup);
		
		
		var vrijeme= document.createElement('span');
		vrijeme.textContent= vrijemePodatak;
		vrijeme.style.marginRight= '20px';

		var danUtjednu= document.createElement('span');
		danUtjednu.textContent= dani;
		danUtjednu.style.marginRight= '30px';
		danUtjednu.style.display= 'inline-block';
		danUtjednu.style.width= '147px';

		var trajanje= document.createElement('span');
		trajanje.textContent= trajanjeImpulsa;
		trajanje.style.display= 'inline-block';
		trajanje.style.width= '25px';

		var buttonP= document.createElement('button');
		var buttonSpan= document.createElement('span');
		buttonSpan.style.marginLeft= '15px';
						
		buttonP.textContent= 'P';
		buttonSpan.appendChild(buttonP);

		buttonP.onclick= function(){
			var spanNode= this.parentNode.parentNode;
			var time= spanNode.childNodes[0].textContent;
			var weekDay= spanNode.childNodes[1].textContent;
			var impulseTimeChange= spanNode.childNodes[2].textContent;
			document.getElementById('vrijemeUklopa').value= time;
			document.getElementById('trajanjeUklopa').value= impulseTimeChange;
			weekDay= weekDay.split(' ');
			console.log(weekDay);

			document.getElementById('pon').checked= false;
			document.getElementById('uto').checked= false;
			document.getElementById('sri').checked= false;
			document.getElementById('cet').checked= false;
			document.getElementById('pet').checked= false;
			document.getElementById('sub').checked= false;
			document.getElementById('ned').checked= false;
			document.getElementById('sviDani').checked= false;

			document.getElementById('pon').disabled= false;
			document.getElementById('uto').disabled= false;
			document.getElementById('sri').disabled= false;
			document.getElementById('cet').disabled= false;
			document.getElementById('pet').disabled= false;
			document.getElementById('sub').disabled= false;
			document.getElementById('ned').disabled= false;

			if(weekDay[0]=='Po'){
				document.getElementById('pon').checked= true;
			}
			if(weekDay[1]=='Ut'){
				document.getElementById('uto').checked= true;
			}
			if(weekDay[2]=='Sr'){
				document.getElementById('sri').checked= true;
			}
			if(weekDay[3]=='Če'){
				document.getElementById('cet').checked= true;
			}
			if(weekDay[4]=='Pe'){
				document.getElementById('pet').checked= true;
			}
			if(weekDay[5]=='Su'){
				document.getElementById('sub').checked= true;
			}
			if(weekDay[6]=='Ne'){
				document.getElementById('ned').checked= true;
			}

			if((weekDay[0]=='Po') && (weekDay[1]=='Ut') && (weekDay[2]=='Sr') && (weekDay[3]=='Če') && (weekDay[4]=='Pe') && (weekDay[5]=='Su') && (weekDay[6]=='Ne')){
				document.getElementById('pon').disabled= true;
				document.getElementById('uto').disabled= true;
				document.getElementById('sri').disabled= true;
				document.getElementById('cet').disabled= true;
				document.getElementById('pet').disabled= true;
				document.getElementById('sub').disabled= true;
				document.getElementById('ned').disabled= true;
				document.getElementById('sviDani').checked= true;
			}
			
			var programDelete= this.parentNode.parentNode.getAttribute('data-group');
			time= time.split(':');

			timeDeleteHours= time[0].split('');
			timeDeleteMinutes= time[1].split('');

			if(timeDeleteHours[0]== '0'){
				timeDeleteHoursStr= timeDeleteHours[1];
			}else{
				timeDeleteHoursStr= timeDeleteHours[0] +timeDeleteHours[1];
			}

			if(timeDeleteMinutes[0]== '0'){
				timeDeleteMinutesStr= timeDeleteMinutes[1];
			}else{
				timeDeleteMinutesStr= timeDeleteMinutes[0] +timeDeleteMinutes[1];
			}

			for(var i= 0; i<weekList.length; i++){
				if(weekList[i][0]==programDelete){
					if(weekList[i][1]==timeDeleteHoursStr){
						if(weekList[i][2]==timeDeleteMinutesStr){
							weekList.splice(i,1);
						}
					}
				}
			}
			spanNode.remove();
		}
		
		var buttonX= document.createElement('button'); 
		buttonX.style.marginLeft= '3px';
		buttonX.textContent= 'X';
		buttonX.style.float= 'right';

		buttonX.onclick= function(){
			var timeDelete= this.parentNode.childNodes[0].textContent;
			var programDelete= this.parentNode.getAttribute('data-group');
			timeDelete= timeDelete.split(':');
			timeDeleteHours= timeDelete[0].split('');
			timeDeleteMinutes= timeDelete[1].split('');

			if(timeDeleteHours[0]== '0'){
				timeDeleteHoursStr= timeDeleteHours[1];
			}else{
				timeDeleteHoursStr= timeDeleteHours[0] +timeDeleteHours[1];
			}

			if(timeDeleteMinutes[0]== '0'){
				timeDeleteMinutesStr= timeDeleteMinutes[1];
			}else{
				timeDeleteMinutesStr= timeDeleteMinutes[0] + timeDeleteMinutes[1];
			}
			for(var i= 0; i<weekList.length; i++){
				if(weekList[i][0]==programDelete){
					if(weekList[i][1]==timeDeleteHoursStr){
						if(weekList[i][2]==timeDeleteMinutesStr)
							weekList.splice(i,1);
					}
				}
			}
			this.parentNode.remove();
		}

		novaVremenskaLista.appendChild(vrijeme);
		novaVremenskaLista.appendChild(danUtjednu);
		novaVremenskaLista.appendChild(trajanje);
		novaVremenskaLista.appendChild(buttonSpan);
		novaVremenskaLista.appendChild(buttonX);

		document.getElementById('vremenskaLista').appendChild(novaVremenskaLista);
	}

	var vrijednostTjedna= 0;
	document.getElementById('dodajVremListu').addEventListener('click', function(){
		var daniTjedan= '';
		vrijednostTjedna= 0;

		if(document.getElementById('pon').checked){
			daniTjedan+= 'Po ';
			vrijednostTjedna+= 64;
		}else{
			daniTjedan+= '-- ';
		}

		if(document.getElementById('uto').checked){
			daniTjedan+= 'Ut ';
			vrijednostTjedna+= 32;
		}else{
			daniTjedan+= '-- ';
		}

		if(document.getElementById('sri').checked){
			daniTjedan+= 'Sr ';
			vrijednostTjedna+= 16;
		}else{
			daniTjedan+= '-- ';
		}

		if(document.getElementById('cet').checked){
			daniTjedan+= 'Če ';
			vrijednostTjedna+= 8;
		}else{
			daniTjedan+= '-- ';
		}

		if(document.getElementById('pet').checked){
			daniTjedan+= 'Pe ';
			vrijednostTjedna+= 4;
		}else{
			daniTjedan+= '-- ';
		}

		if(document.getElementById('sub').checked){
			daniTjedan+= 'Su ';
			vrijednostTjedna+= 2;
		}else{
			daniTjedan+= '-- ';
		}

		if(document.getElementById('ned').checked){
			daniTjedan+= 'Ne';
			vrijednostTjedna+= 1;
		}else{
			daniTjedan+= '--';
		}
		
		if(!document.getElementById('pon').checked && !document.getElementById('uto').checked && !document.getElementById('sri').checked && !document.getElementById('cet').checked && !document.getElementById('pet').checked && !document.getElementById('sub').checked && !document.getElementById('ned').checked){
			alert('Potrebno je odabrati dan u tjednu!');
		}else{
			appendToWeeklist(document.getElementById('tjedniProgramSelect').value, document.getElementById('vrijemeUklopa').value, daniTjedan, vrijednostTjedna, document.getElementById('trajanjeUklopa').value);
		}
	});

	var removedPrograms= [];

	document.getElementById('buttUp').addEventListener('click', function(){
		buttonUp();
	});
	function buttonUp(){
		document.getElementById('buttDown').disabled= false;
		document.getElementById('dodajVremListu').disabled= false;
		document.getElementById('dodajGodListu').disabled= false;

		if(document.getElementById('tjedniProgramSelect').length<100){
			var option= document.createElement('option');
			if(removedPrograms.length!=0){
				option.value= removedPrograms[0];
				option.text= 'P' + removedPrograms[0];
				removedPrograms.shift();
			}else{
				option.value= document.getElementById('tjedniProgramSelect').length;
				option.text= 'P' +  document.getElementById('tjedniProgramSelect').length;
			}
			document.getElementById('tjedniProgramSelect').add(option);
			sortOptionsWithDigits('tjedniProgramSelect');
			option.selected= true;
		}
		copyOptions("tjedniProgramSelect", "programGodisnja");
		prikazVremenaPrograma();
	}

	document.getElementById('buttDown').addEventListener('click', function(){
		var selectedProgramToDelete= document.getElementById('tjedniProgramSelect').value;
		for(var i= weekList.length - 1; i>=0; i--){	
			if(weekList[i][0]==selectedProgramToDelete){
				weekList.splice(i,1);
			}
		}

		for(var j= yearList.length - 1; j>=0; j--){
			if(yearList[j][4]==selectedProgramToDelete){
				yearList.splice(j,1);
			}
			prikazGodisnjegPrograma();
		}

		if(document.getElementById('tjedniProgramSelect').length!=0){
			var selectedIndex= document.getElementById('tjedniProgramSelect').selectedIndex;
			removedPrograms.push(document.getElementById('tjedniProgramSelect').options[selectedIndex].value);
			removedPrograms.sort(function(a, b) {
   		 		return a - b;
			});
			document.getElementById('tjedniProgramSelect').options.remove(selectedIndex);
		}
		if(document.getElementById('tjedniProgramSelect').length==0){
			document.getElementById('buttDown').disabled= true;
			document.getElementById('dodajVremListu').disabled= true;
			document.getElementById('dodajGodListu').disabled= true;
		}
		copyOptions("tjedniProgramSelect", "programGodisnja");
		prikazVremenaPrograma();
	});

	window.onload= function(){
		activeTab();
		document.getElementById('buttDown').disabled= true;
		document.getElementById('dodajVremListu').disabled= true;
		document.getElementById('dodajGodListu').disabled= true;
	}

	document.getElementById('dodajGodListu').addEventListener('click', function (){
		var datum= document.getElementById('dateChoosen').value
		datum= datum.split('-');
		var program= document.getElementById('programGodisnja').value;
		var relej= document.getElementById('releji').value;
		
		if(document.getElementById('dateChoosen').value==''){
			alert('Potrebno je unijeti validan datum!');
		}else{
			appendToYearList();
			yearList.sort(customSortYear);
			prikazGodisnjegPrograma();
		}
		console.log(yearList);
	});

	function prikazGodisnjegPrograma(){
			var selectedProgram= document.getElementById('releji').value;
			document.getElementById('godiListaPrikaz').innerHTML= '';
			for(var i=0; i<yearList.length; i++){
				if(selectedProgram==yearList[i][0]){
					dodajGodisnjuListu(formatRelej(yearList[i][0]), 'P' + yearList[i][4], formatDay(yearList[i][3]) + '.' + formatMonth(yearList[i][2])  + '.' + '20' + yearList[i][1] + '.');
				}
				if(selectedProgram== '0'){
					dodajGodisnjuListu(formatRelej(yearList[i][0]), 'P' + yearList[i][4], formatDay(yearList[i][3]) + '.' + formatMonth(yearList[i][2])  + '.' + '20' + yearList[i][1] + '.');
				}
			}
		}

	document.getElementById('releji').addEventListener('change', function (){
			prikazGodisnjegPrograma();
		});

	function formatRelej(week){
		if(week=='241'){
			return 'R1';
		}else if(week=='242'){
			return 'R2';
		}else if(week=='243'){
			return 'R3';
		}else{
			return 'R4';
		}
	}
	function formatDay(day){
		if(day.length==1){
			return '0' + day;
		}else{
			return day;
		}
	}
	function formatMonth(month){
		if(month.length==1){
			return '0' + month;
		}else{
			return month;
		}
	}

	function appendToYearList(){
		var godisnjaListaProgram= [];	
		var relej= document.getElementById('releji').value;
		var sameyearProgram= false;

		godisnjaListaProgram.push(relej);

		var datum= document.getElementById('dateChoosen').value;
		datum= datum.split('-');
		var godina= datum[0].split('');
		godisnjaListaProgram.push(godina[2]+godina[3]);

		var mjesec= datum[1].split('');
		if(mjesec[0]=='0'){
			godisnjaListaProgram.push(mjesec[1]);
		}else{
			godisnjaListaProgram.push(mjesec[0]+mjesec[1]);
		}

		var dan= datum[2].split('');
		if(dan[0]== '0'){
			godisnjaListaProgram.push(dan[1]);
		}else{
			godisnjaListaProgram.push(dan[0]+dan[1]);
		}
		var program= document.getElementById('programGodisnja').value;
		godisnjaListaProgram.push(program);

		var brojPrograma= 0;
		for(var i= 0; i< weekList.length; i++){
			if(weekList[i][0]==program){
				brojPrograma= brojPrograma + 1;
			}
		}
		if(brojPrograma==0){
			alert('Program je prazan');
		}else{
			if(relej==0){
				for(var j=1;j<=4;j++){
					sameyearProgram= false;
					godisnjaListaProgram.splice(0,1);
					godisnjaListaProgram.unshift('24' + j);

					for(var i= 0; i<yearList.length; i++){	
						if(yearList[i][0]==godisnjaListaProgram[0]){
							if(yearList[i][1]==godisnjaListaProgram[1]){
								if(yearList[i][2]==godisnjaListaProgram[2]){
									if(yearList[i][3]==godisnjaListaProgram[3]){
										sameyearProgram= true;
									}
								}
							}
						}
					}
					if(sameyearProgram==true){
						alert('Upisan isti datum!');
					}else{
						yearList.push([...godisnjaListaProgram]);
					}
				}
			}else{
				for(var i= 0; i<yearList.length; i++){
						if(yearList[i][0]==godisnjaListaProgram[0]){
							if(yearList[i][1]==godisnjaListaProgram[1]){
								if(yearList[i][2]==godisnjaListaProgram[2]){
									if(yearList[i][3]==godisnjaListaProgram[3]){
										if(yearList[i][4]==godisnjaListaProgram[4]){
											sameyearProgram= true;
									}
								}
							}
						}
					}
				}
				if(sameyearProgram==true){
					alert('Upisan isti program!')
				}else{
					yearList.push(godisnjaListaProgram);
				}
			}
	}
		popunjenostMemorije();
	}

	function dodajGodisnjuListu(dataGroup, programNum, datumNum){
		var novaGodisnjaLista= document.createElement('div');
		novaGodisnjaLista.className= 'memorija';
		novaGodisnjaLista.setAttribute('data-group', dataGroup);

		var relej= document.createElement('span');
		relej.textContent= dataGroup;
		relej.style.marginRight= '60px';

		var datum= document.createElement('span');
		datum.textContent= datumNum;
		datum.style.marginRight= '70px';

		var program= document.createElement('span');
		program.textContent= programNum;
		program.style.marginRight= '20px';
		program.style.display= 'inline-block';
		program.style.width= '30px';

		var buttonP= document.createElement('button');
		buttonP.textContent= 'P';

		buttonP.onclick= function(){
			var relej= this.parentNode.childNodes[0].textContent;
			relej= relej.split('');
			document.getElementById('releji').selectedIndex= relej[1];
			
			var datum= this.parentNode.childNodes[1].textContent;
			datum= datum.split('.');
			datum.splice(-1,1);

			var dan= datum[0].split('');

			if(dan[0]== '0'){
				danStr= dan[1];
			}else{
				danStr= dan[0] + dan[1];
			}

			var mjesec= datum[1].split('');

			if(mjesec[0]== '0'){
				mjesecStr= mjesec[1];
			}else{
				mjesecStr= mjesec[0]+mjesec[1];
			}

			var godina= datum[2].split('');
			godinaStr= godina[2]+godina[3];

			document.getElementById('dateChoosen').value= '20'+ godinaStr + '-'+ mjesec[0] + mjesec[1] + '-' + dan[0] + dan[1];

			var program= this.parentNode.childNodes[2].textContent;
			program= program.split('');

			if(program.length==3){
				programStr= program[1] + program[2];
			}else{
				programStr= program[1];
			}

			document.getElementById('programGodisnja').selectedIndex= programStr;

			for(var i= 0; i<yearList.length; i++){
				if(yearList[i][0]==('24' + relej[1])){
					if(yearList[i][1]==godinaStr){
						if(yearList[i][2]==mjesecStr){
							if(yearList[i][3]==danStr){
								if(yearList[i][4]=programStr){
									yearList.splice(i,1);
								}
							}
						}
					}
					}
				}

			this.parentNode.remove();
		} 

		var buttonX= document.createElement('button');
		buttonX.textContent= 'X';
		buttonX.style.marginLeft= '3px';
		buttonX.style.float= 'right';

		buttonX.onclick= function(){
			var relej= this.parentNode.childNodes[0].textContent;
			relej= relej.split('');
			
			var datum= this.parentNode.childNodes[1].textContent;
			datum= datum.split('.');
			datum.splice(-1,1);

			var dan= datum[0].split('');

			if(dan[0]== '0'){
				danStr= dan[1];
			}else{
				danStr= dan[0] + dan[1];
			}

			var mjesec= datum[1].split('');

			if(mjesec[0]== '0'){
				mjesecStr= mjesec[1];
			}else{
				mjesecStr= mjesec[0]+mjesec[1];
			}

			var godina= datum[2].split('');
			godinaStr= godina[2]+godina[3];

			var program= this.parentNode.childNodes[2].textContent;
			program= program.split('');

			if(program.length==3){
				programStr= program[1] + program[2];
			}else{
				programStr= program[1];
			}

			for(var i= 0; i<yearList.length; i++){
				if(yearList[i][0]==('24' + relej[1])){
					if(yearList[i][1]==godinaStr){
						if(yearList[i][2]==mjesecStr){
							if(yearList[i][3]==danStr){
								if(yearList[i][4]=programStr){
									yearList.splice(i,1);
								}
							}
						}
					}
					}
				}

			this.parentNode.remove();
		}

		novaGodisnjaLista.appendChild(relej);
		novaGodisnjaLista.appendChild(datum);
		novaGodisnjaLista.appendChild(program);
		novaGodisnjaLista.appendChild(buttonP);
		novaGodisnjaLista.appendChild(buttonX);

		document.getElementById('godiListaPrikaz').appendChild(novaGodisnjaLista);
	}

	function sortOptionsWithDigits(id) {
            // Get the select element
            var select = document.getElementById(id);

            // Get the options and convert to an array
            var optionsArray = Array.from(select.options);

            // Sort the options based on their numeric values
            optionsArray.sort(function(a, b) {
                // Extract numeric values from the strings using regular expressions
                var aValue = parseInt(a.value.match(/\d+/)[0], 10);
                var bValue = parseInt(b.value.match(/\d+/)[0], 10);

                return aValue - bValue;
            });

            // Remove existing options from the select element
            for (var i = select.options.length - 1; i >= 0; i--) {
                select.remove(i);
            }

            // Add the sorted options back to the select element
            optionsArray.forEach(function(option) {
                select.add(option);
            });
        }

		function copyOptions(sourceSelectId, targetSelectId) {
            // Get the source and target select elements
            var sourceSelect = document.getElementById(sourceSelectId);
            var targetSelect = document.getElementById(targetSelectId);
			while (targetSelect.options.length > 0) {
                targetSelect.remove(0);
            }
            // Loop through each option in the source select
            for (var i = 0; i < sourceSelect.options.length; i++) {
                // Clone the option from the source select
                var optionClone = sourceSelect.options[i].cloneNode(true);

                // Add the cloned option to the target select
                targetSelect.add(optionClone);
            }
        }
		function appendToWeeklist(programNumber, timeOfDay, daniTjedan, vrijednostTjedna, impulseTime){
			var programLine= [];
			programLine.push(programNumber);
			var timeOfDaySplit= timeOfDay.split(':');
			hoursTime= timeOfDaySplit[0].split('');
			minutesTime= timeOfDaySplit[1].split('');
			if(hoursTime[0]=='0'){
				programLine.push(hoursTime[1]); 
			}else{
				programLine.push(hoursTime[0] + hoursTime[1]);
			}
			if(minutesTime[0]=='0'){
				programLine.push(minutesTime[1]); 
			}else{
				programLine.push(minutesTime[0] + minutesTime[1]);
			}
			programLine.push(vrijednostTjedna.toString());
			if(impulseTime== 'Off'){
				programLine.push('0');
			}else if(impulseTime== 'On'){
				programLine.push('100');
			}else{
				programLine.push(impulseTime);
			}
			checkForTime(programLine);
			console.log(weekList);
		}
		function checkForTime(programLine){
			var sameTime= false;
			for(var i= 0; i<weekList.length; i++){
				if(weekList[i][1]==programLine[1]){
					if(weekList[i][2]==programLine[2]){
						if(weekList[i][0]==programLine[0])
							sameTime= true;
					}
				}
			}
			if(sameTime==false){
				weekList.push(programLine);
				//dodajVremenskuListu(programNumber, timeOfDay, daniTjedan, impulseTime);
				prikazVremenaPrograma();
			}else{
				alert('Odabrano vrijeme je uneseno!');
			}
		}
		document.getElementById('tjedniProgramSelect').addEventListener('change', function (){
			prikazVremenaPrograma();
		});
		function prikazVremenaPrograma(){
			var selectedProgram= document.getElementById('tjedniProgramSelect').value;
			document.getElementById('vremenskaLista').innerHTML= '';
			for(var i=0; i<weekList.length; i++){
				if(selectedProgram==weekList[i][0]){
					weekList.sort(customSort);
					dodajVremenskuListu(weekList[i][0], formatTime(weekList[i][1], weekList[i][2]), formatWeek(weekList[i][3]), formatImpulse(weekList[i][4]));
				}
			}
			popunjenostMemorije();
		}
		function formatTime(hours,minutes){
			if(hours.length==1){
				hours= '0' + hours;
			}
			if(minutes.length==1){
				minutes= '0' + minutes;
			}
			return hours + ':' + minutes;
		}
		function formatWeek(weekNumber){
			var weekString= '';

			if((weekNumber & 64)== 64){
				weekString+= 'Po ';
			}else{
				weekString+= '-- ';
			}
			if((weekNumber & 32)== 32){
				weekString+= 'Ut ';
			}else{
				weekString+= '-- ';
			}
			if((weekNumber & 16)== 16){
				weekString+= 'Sr ';
			}else{
				weekString+= '-- ';
			}
			if((weekNumber & 8)== 8){
				weekString+= 'Če ';
			}else{
				weekString+= '-- ';
			}
			if((weekNumber & 4)== 4){
				weekString+= 'Pe ';
			}else{
				weekString+= '-- ';
			}
			if((weekNumber & 2)== 2){
				weekString+= 'Su ';
			}else{
				weekString+= '-- ';
			}
			if((weekNumber & 1)== 1){
				weekString+= 'Ne';
			}else{
				weekString+= '--';
			}
			return weekString;
		}
		function formatImpulse(impulseNumber){
			var impulseStr= '';
			if(impulseNumber==0){
				impulseStr= 'Off';
			}else if(impulseNumber==100){
				impulseStr= 'On';
			}else{
				impulseStr= impulseNumber;
			}
			return impulseStr;
		}
		function customSort(a, b) {
		if (a[0] !== b[0]) {
        	return a[0] - b[0];
    	}
    	if (a[1] !== b[1]) {
        	return a[1] - b[1];
    	}
    	if (a[2] !== b[2]) {
    	    return a[2] - b[2];
	    }
		return 0;
		}

		function customSortYear(a, b) {
    	if (a[0] !== b[0]) {
        	return a[0] - b[0];
    	}
		if (a[1] !== b[1]) {
    	    return a[1] - b[1];
	    }
    	if (a[2] !== b[2]) {
    	    return a[2] - b[2];
	    }
		if (a[3] !== b[3]) {
    	    return a[3] - b[3];
	    }
		return 0;
		}

		document.getElementById('brisiSve').addEventListener('click', function (){
			location.reload();
			document.getElementById('tekstProgram').value= '';
		});


		var zeroNum=0;
		var dataTekstSplit=[];

		document.getElementById('SpremiEMC').addEventListener('click', function (){
			formatTekstualniProgram();

			dataTekst= document.getElementById('tekstProgram').value;
			dataTekstSplit= dataTekst.split('\n');
			zeroNum=0;
			dataTekstSplit.pop();
			console.log(dataTekstSplit);
			dataTekstSplit.unshift('E0');
			dataTekstSplit.push('F1');
			dataTekstSplit.push('E1');
			index=0;
			
			console.log(dataTekstSplit);
			otkaziSlanje= false;
			postDataSequentially(index);
		});

		function postDataSequentially(index){
			if((index<dataTekstSplit.length)&&(otkaziSlanje==false)){
				dataTekstSplit[index]= dataTekstSplit[index].replace(/\s/g, '');
				dataCheck= dataTekstSplit[index].split(',');
				//console.log(dataCheck);
				if((dataCheck[1]=='0')&&(dataCheck[2]=='0')&&(dataCheck[3]=='0')&&(dataCheck[4]=='0')&&(dataCheck[5]=='0')){
					zeroNum++;
				}
				if(zeroNum==0){
					message= '' + dataTekstSplit[index];
				}else if(zeroNum==1){
					message= 'P' + dataTekstSplit[index];
					zeroNum++
				}else if(zeroNum==2){
					message= 'R' + dataTekstSplit[index];
				}else if(zeroNum==3){
					message= 'P' + dataTekstSplit[index];
				}else if(zeroNum==4){
					message= 'P' + dataTekstSplit[index];
					zeroNum++;
				}else if(zeroNum==5){
					message= '' + dataTekstSplit[index];
				}
				const endpoint= `/admin/li.cgi?l=${message}`;
				console.log(endpoint);
				
				fetch(endpoint,{
         			method: 'POST'
        		})
        		.then(response=>{response.text();})
        		.then(data => {
					console.log('Data received:', data);
					index++
					ucitavanjeSEMCa(index, false, dataTekstSplit.length);
					postDataSequentially(index);
				})
        		.catch(error => {console.error('Error during fetch:', error);})
			
			}else{
				ucitavanjeSEMCa(index, true, dataTekstSplit.length);
			}
	}



		function formatTekstualniProgram(){
			var podaciGodisnjaLista= '0,0,0,0,0,0\n';
			document.getElementById('tekstProgram').value= podaciGodisnjaLista;
			for(var i=0; i<yearList.length; i++){
				podaciGodisnjaLista= i+1 + ',' + yearList[i][0] + ',' + yearList[i][1] + ',' + yearList[i][2] + ',' + yearList[i][3] + ',' + yearList[i][4] + '\n';
				document.getElementById('tekstProgram').value+= podaciGodisnjaLista;
			}

			podaciGodisnjaLista= yearList.length + 1 +',0,0,0,0,0\n';
			document.getElementById('tekstProgram').value+= podaciGodisnjaLista; 

			var trenutniRed= yearList.length +2;
			for(var i=0; i<weekList.length; i++){
				podaciGodisnjaLista= trenutniRed+ i + ',' + weekList[i][0] + ',' + weekList[i][1] + ',' + weekList[i][2] + ',' + weekList[i][3] + ',' + weekList[i][4] + '\n';
				document.getElementById('tekstProgram').value+= podaciGodisnjaLista;
			}

			podaciGodisnjaLista= weekList.length + trenutniRed +',0,0,0,0,0\n';
			document.getElementById('tekstProgram').value+= podaciGodisnjaLista; 
		}

		document.getElementById('ucitajIzTeksta').addEventListener('click', function(){
			ucitavanje();
		});
		
		function ucitavanje(){
			removeAllOptions();
			if(document.getElementById('tekstProgram').value== ''){
				alert('Tekstualni program je prazan!');
			}else{
				var tekst= document.getElementById('tekstProgram').value;
				tekst= tekst.split('\n');
				for(var i=0; i< tekst.length; i++){
					tekst[i]= tekst[i].replace(/\s/g, "");
					tekst[i]= tekst[i].split(',');
				}
				var broj=0;
				if((tekst[0][0]!='0')||(tekst[0][1]!='0')||(tekst[0][2]!='0')||(tekst[0][3]!='0')||(tekst[0][4]!='0')||(tekst[0][5]!='0')){
					alert('Krivi unos!');
				}else{
					weekList= [];
					yearList= [];

					broj= broj + 1;
					for(var i=1; i<tekst.length; i++){
						
						if((tekst[i][0]==i)&&(tekst[i][1]=='0')&&(tekst[i][2]=='0')&&(tekst[i][3]=='0')&&(tekst[i][4]=='0')&&(tekst[i][5]=='0')){
							broj= broj + 1;
						}else if(broj==1){
							tekst[i].splice(0,1);
							console.log(tekst[i]);
							if((tekst[i][1]==0)&&(tekst[i][2]==0)&&(tekst[i][3]==0)){
								tekst[i][1]='20';
								tekst[i][2]='1';
								tekst[i][3]='1';
							}
							// Ovdje dodaj da 0,0,0 datum se prebacuje u datum 01.01.2020.
							yearList.push(tekst[i]);
						}else if(broj==2){
							tekst[i].splice(0,1);
							weekList.push(tekst[i]);
						}
					}
					yearList.sort(customSortYear);
					prikazGodisnjegPrograma();
					var programs= []
					for(var i=0; i<weekList.length; i++){
						programs.push(weekList[i][0]);
					}
					var programs= [...new Set(programs)];
					createPrograms(programs);
					prikazVremenaPrograma();
				}
				
			}
		}

		function createPrograms(programs){
			removedPrograms= programs.slice();
			for(var i=0; i<programs.length; i++){
				buttonUp();
			}
			programs= findMissingNumbers(programs.map(Number));
			removedPrograms= programs.map(String);
		}

		function findMissingNumbers(arr) {
			var min = Math.min(...arr);
			var max = Math.max(...arr);
			var missingNumbers = [];

    		for (var i = min; i <= max; i++) {
        		if (!arr.includes(i)) {
            		missingNumbers.push(i);
        		}
    		}

    		return missingNumbers;
		}
		function removeAllOptions() {
			var selectElement = document.getElementById("tjedniProgramSelect");
			var tjedniSelect= document.getElementById('programGodisnja');
    		while (selectElement.options.length > 0) {
        		selectElement.remove(0);
    		}
			while (tjedniSelect.options.length > 0) {
        		tjedniSelect.remove(0);
    		}
		}
		function popunjenostMemorije(){
			var memorijaZbroj= weekList.length + yearList.length;

			if(Math.abs(memorijaZbroj).toString().length==1){
				memorijaZbrojStr= '00' + memorijaZbroj;
			}else if(Math.abs(memorijaZbroj).toString().length==2){
				memorijaZbrojStr= '0' + memorijaZbroj;
			}else{
				memorijaZbrojStr= memorijaZbroj;
			}
			document.getElementById('memorijaPop').innerHTML= 'Memorija: ' + memorijaZbrojStr + '/800';
		}

		var breakCond=0;
		var dataSplit=0;
		document.getElementById('ucitajEMC').addEventListener('click', function(){
			var lineNum= 0;
			breakCond=0;
			document.getElementById('tekstProgram').value= '';
			otkaziSlanje= false;
			while((lineNum<800)&&(breakCond<3)&&(otkaziSlanje== false)){
				fetchDataSynchronously(lineNum);
				if((dataSplit[1]=='0')&&(dataSplit[2]=='0')&&(dataSplit[3]=='0')&&(dataSplit[4]=='0')&&(dataSplit[5]=='0\r\n ')){
					breakCond++;
				}
				lineNum++;
				ucitavanjeSEMCa(lineNum, false, '---');
				document.getElementById('tekstProgram').value+= dataSplit;
			}
			ucitavanjeSEMCa(lineNum, true, '---');
			ucitavanje();
		});
	
	function fetchDataSynchronously(lineNum) {
		if(lineNum.toString().length==1){
			line= '00' + lineNum;
		}else if(lineNum.toString().length==2){
			line= '0' + lineNum;
		}else{
			line= lineNum.toString();
		}

		const endpoint=`/admin/li.cgi?l=L${line}`

		const xhr = new XMLHttpRequest();
  		// Configure the request
  		xhr.open('GET',endpoint, false); // Set the third parameter to 'false' for synchronous

  		try{
    		// Send the request
    		xhr.send();
    		// Check if the response status is OK (200-299)
    		if (xhr.status >= 200 && xhr.status < 300) {
      			const data =xhr.responseText;
				//console.log(data);
      			dataSplit= data.split(',');
				//console.log(dataSplit);
    		}else{
      			throw new Error('Network response was not ok');
   		 	}
		}catch(error){
    		// Handle errors
    		console.error('Error during synchronous request:', error);
  		}
	}

	function ucitavanjeSEMCa(broj, status, ukupniBroj){
		if(broj.toString().length==1){
			brojStr= '00' + broj;
		}else if(broj.toString().length==2){
			brojStr= '0' + broj;
		}else{
			brojStr= broj;
		}
		
		if(ukupniBroj=='---'){
			ukupniBrojStr= ukupniBroj;
		}else if(ukupniBroj.toString().length==1){
			ukupniBrojStr= '00' + ukupniBroj;
		}else if(ukupniBroj.toString().length==2){
			ukupniBrojStr= '0' + ukupniBroj;
		}else{
			ukupniBrojStr= ukupniBroj;
		}

		if(status== false){
			document.getElementById('ucitavanje').innerHTML= 'Učitavanje: ' + brojStr + ' od ' + ukupniBrojStr;
		}else{
			document.getElementById('ucitavanje').innerHTML= 'Učitavanje: ' + brojStr + ' od ' + ukupniBrojStr + ' OK';
		}
		
	}

	document.getElementById('otkaz').addEventListener('click', function(){
		otkaziSlanje= true;
	});

</script>

<style>
	#buttDown:disabled {
		opacity: 0.5;
		cursor: not-allowed;
		background-color: gray;
	}
	#dodajVremListu:disabled {
		opacity: 0.5;
		cursor: not-allowed;
		background-color: gray;
	}
	#dodajGodListu:disabled {
		opacity: 0.5;
		cursor: not-allowed;
		background-color: gray;
	}
	.vremLista {
		background-color: lightgray; 
		margin: 5px; 
		padding: 5px;
	}
	.godLista {
		background-color:  lightgray;
		margin: 5px;
		padding: 5px;
	}
	#dani {
		display: grid;
		grid-template-columns: repeat(7, auto);
		justify-items: center;
		align-items: center;
	}
	#slideri {
		display: grid;
		grid-template-columns: 100px 100px 1px auto;
		justify-items: center;
		align-items: center;
	}
	#main {
		display: grid;
		grid-template-rows: repeat(3, auto);
		border-radius: 10px;
		padding: 5px;
		gap: 5px;
		border: 2px solid;
	}
	#gornjiRed {
		border-bottom: 2px solid;
		padding: 5px;
	}
	.butt {
	padding: 5px 10px;
	font-size: 15px; 
	background-color: #8b0000; 
	color: white; 
	border-radius: 10px;
	margin: 5px;
    }
    .butt:hover {
        background-color: gray;
    }
	.memorija {
		border: 2px solid #8b0000;
		border-radius: 10px;
		padding: 4px;
		margin: 5px;
	}
	#box {
		display: grid;
		grid-template-columns: auto auto auto;
	}
	.columnStyle {
		border: 1px solid;
		padding: 3px;
	}
	#godisnjaLista {
		display: grid;
		grid-template-rows: 70px 40px 30px 30px auto;
		align-items: center;
	}
	#odabirIzlazaDatuma {
		display: grid;
		grid-template-columns: repeat(3, auto);
		text-align: center;
	}
	#odabirReleja {
		display: grid;
		grid-template-rows: auto auto;
	}
	#odabirDatuma {
		display: grid;
		grid-template-rows: auto auto;
	}
	#odabirPrograma {
		display: grid;
		grid-template-rows: repeat(2, auto);
	}
	#tjedniProgram {
		display: grid;
		grid-template-rows: 30px 35px 30px 40px 30px 30px 40px 30px 30px auto;
		align-items: center;
	}
	.tjedniProgramGore1 {
		display: grid;
		grid-template-columns: repeat(4, auto);
		align-items: center;
	}
	.tjedniProgramGore2 {
		display: grid;
		grid-template-columns: 200px auto;
		align-items: center;
		text-align: center;
	}
	#teksProgram {
		display: grid;
		grid-template-rows: auto auto auto;
		align-items: center;
	}
	#link {
		text-align: center;
		border:2px solid #8b0000;
		border-radius: 10px;
		padding: 5px;
	}
</style>